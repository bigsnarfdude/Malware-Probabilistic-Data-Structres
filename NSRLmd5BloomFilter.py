import pybloomfilter
import urllib2

"""
class ingests MD5 data from NSRLFile and updates bloomfilter


>>>hash_bloom = MD5BloomFilter(size, error, bloom_filename)
>>>hashed = hash_bloom.stream_lines()
>>>hash_bloom.update(hash_bloom.hash_list)
>>>hash_bloom.process_infile(hashed)
>>>print "583401402C3F77A8C94FA782EB437C0F" in hash_bloom # True
>>>print "testTesttest" in hash_bloom # False

"""

size = 1000000
error = 0.001
bloom_filename = 'NSRLgood.bloomfilter'
filename = '~/Downloads/unique/NSRLFile.txt'
nsrl_destination_url = 'http://www.nsrl.nist.gov/RDS/rds_2.43/rds_243u.zip'

class MD5BloomFilter(pybloomfilter.BloomFilter):

    def __init__(self, size, error, bloom_filename):
        self.size = size
        self.error = error
        self. bloom_filename = bloom_filename
        self.filename = '~/Downloads/unique/NSRLFile.txt'
        self.hash_list = []

    def stream_lines(self):
        infile = open(self.filename)
        while True:
            line = infile.readline()
            if not line:
                infile.close()
                break
            yield line.split(",")[1].strip('"')

    def process_infile(self, hashes):
        for item in hashes:
            print item
            self.hash_list.append(item)

